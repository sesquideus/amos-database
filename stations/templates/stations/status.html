{% extends 'core/base.html' %}
{% load station_tags %}
{% load tz %}

{% block pagetitle %}
<h2>Network status</h2>
{% endblock pagetitle %}

{% block page %}
    <table>
        <tr>
            <th>subnetwork</th>
            <th>code</th>
            <th>name</th>
            <th>status</th>
            <th>local time</th>
            <th colspan="2">&#x2600;</th>
            <th colspan="2">last sighting</th>
            <th>admin</th>
        </tr>
        {% for subnetwork in subnetworks %}
            {% for station in subnetwork.station_set.all %}
                <tr>
                    {% if forloop.first %}
                        <td class="multihead" rowspan="{{ subnetwork.station_set.all|length }}">{{ subnetwork.name }}</td>
                    {% endif %}
                    <td class="station">{{ station.code }}</td>
                    <td><a href="{% url 'station' code=station.code %}">{{ station.name }}</a></td>
                    <td class="status">unknown</td>
                    <td id="{{ station.code }}-localtime" class="time">
                        {% timezone station.timezone %}
                            <abbr title="{% now "Y-m-d" %}" >{% now "H:i" %}</abbr>
                        {% endtimezone %}
                    </td>
                    <td id="{{ station.code }}-sunalt" class="data" style="color: {{ station.sunPosition.alt|altitudeColour }};">
                        {{ station.sunPosition.alt|floatformat:1 }}°
                        <span class="suninfo" style="transform: rotate({{ station.sunPosition.alt|multiply:-1 }}deg);">&#8594;</span>
                    </td>
                    <td id="{{ station.code }}-sunaz" class="data">
                        {{ station.sunPosition.az|floatformat:1 }}°
                        <span class="suninfo" style="transform: rotate({{ station.sunPosition.az|add:-90 }}deg);">&#8594;</span>
                    </td>
                    <td class="time">
                        {% if station.lastSighting %}
                            {{ station.lastSighting.lightmaxTime }}
                        {% else %}
                            <span class="empty">no sightings</span>
                        {% endif %}
                    </td>
                    <td class="time">
                        {% if station.lastSighting %}
                            {{ station.lastSighting.lightmaxTime|timesince }}
                        {% else %}
                            <span class="empty">&mdash;</span>
                        {% endif %}
                    </td>
                    <td class="c"><a href="{% url 'admin:stations_station_change' station.id %}">edit</a></td>
                </tr>
            {% empty %}
                <tr>
                    <td>{{ subnetwork.name }}</td>
                    <td colspan="9" class="empty">No stations are defined in this subnetwork.</td>
                </tr>
            {% endfor %}
        {% endfor %}
    </table>
{% endblock page %}
