{% extends 'core/base.html' %}
{% load tz static meteor_tags station_tags %}

{% block pagetitle %}
    <h2>Sighting {{ sighting.id }}</h2>
    <div class="controls">
        {% with previous=sighting.get_previous_by_timestamp next=sighting.get_next_by_timestamp %}
            {% if previous %}
                <a href="{% url 'sighting' id=previous.id %}">
                    <img src="{% static "pictures/previous.png" %}" alt="Previous" />
                </a>
            {% else %}
                <img src="{% static "pictures/previous-gray.png" %}" alt="This is the first sighting" />
            {% endif %}

            <a href="{% url 'admin:meteors_sighting_change' sighting.id %}">
                <img src="{% static "pictures/edit.png" %}" alt="Edit" />
            </a>

            <a href="{% url 'sighting' id=sighting.id %}" target="_blank">
                <img class="icon" src="{% static "pictures/icon-kml.png" %}" alt="View KML" />
            </a>

            {% if next %}
                <a href="{% url 'sighting' id=next.id %}">
                    <img src="{% static "pictures/next.png" %}" alt="Next" />
                </a>
            {% else %}
                <img src="{% static "pictures/next-gray.png" %}" alt="This is the last sighting" />
            {% endif %}
        {% endwith %}
    </div>
{% endblock pagetitle %}

{% block page %}
    <div>
        <p>
            {% if sighting.timestamp %}
                {{ sighting.timestamp|date:"Y-m-d, l" }}
            {% else %}
                <span class="unknown">unknown date</span>
            {% endif %}
        </p>
        <p>
            {% if sighting.meteor.id %}
                Meteor <a class="object-link meteor" href="{% url 'meteor' name=sighting.meteor.name %}">{{ sighting.meteor }}</a>
            {% else %}
                <span class="unknown">Unidentified meteor</span>
            {% endif %}
            observed from <a class="object-link station" href="{% url 'station' code=sighting.station.code %}" id="location-name">{{ sighting.station.name|default_if_none:"(unknown)" }}</a>
            by <span id="observer-name">
                {% if sighting.observer is None %}
                    <span class="unknown">unknown observer</span>
                {% else %}
                    {{ sighting.observer.name }}
                {% endif %}
            </span>
            at <span id="time">{{ sighting.timestamp|date:"Y-m-d H:i:s.u" }}</span>
        </p>
    </div>

    <div class="inner">
        <div class="info">
            {% include 'meteors/sighting/photometry.html' %}
            {% include 'meteors/sighting/sky-info.html' %}

            <h3>Light curve</h3>
            <img class="chart" src="{% url 'sighting-light-curve' id=sighting.id %}" alt="Light curve" />

            <h3>Sky visualisation</h3>
            <img class="chart" src="{% url 'sighting-sky' id=sighting.id %}" alt="Sky visualisation" />

            {% include 'meteors/sighting/video-frames.html' %}
        </div>
        <div class="preview">
            {% if sighting.composite %}
            <a href="{{ sighting.composite.url }}">
                <img class="sighting" src="{{ sighting.composite.url }}" alt="Image for sighting {{ sighting.id }} is missing" />
            </a>
            {% else %}
                <img class="sighting empty" src="{% static "no-image.svg" %} "/>
            {% endif %}
        </div>
    </div>
{% endblock %}
