{% extends 'core/base.html' %}
{% load static %}
{% load tz %}
{% load station_tags %}

{% block pagetitle %}
    <h2>Station <span class="bold">{{ station.name }}</span> (<span class="bold">{{ station.code }}</span>)</h2>
    <div class="controls">
        <a href="{% url 'admin:stations_station_change' station.id %}">
            <img class="" src="{% static 'pictures/edit.png' %}" />
        </a>
    </div>
{% endblock pagetitle %}

{% block page %}
    <h3>Station info</h3>
        <p>{{ station.address }}</p>
        <p id="location">{{ station.location }}</p>
        <p id="localtime">Local time: <span class="b">{% timezone station.timezone %}{% now "Y-m-d H:i:s" %}{% endtimezone %}</span></p>

    <h3>Sun</h3>
        <table>
            <tr>
                <td>altitude</td>
                <td class="data sun">
                    <span class="suninfo standalone" style="color: {{ station.sunPosition.alt|altitudeColour }}">{{ station.sunPosition.alt|floatformat:1 }}°</span>
                </td>
                <td class="data arrow">
                    <span class="arrow" style="transform: rotate({{ station.sunPosition.alt|multiply:-1 }}deg); color: {{ station.sunPosition.alt|altitudeColour }}">&#8594;</span>
                </td>
            </tr>
            <tr>
                <td>azimuth</td>
                <td class="data sun">
                    <span>{{ station.sunPosition.az|floatformat:1 }}°</span>
                </td>
                <td class="data arrow">
                    <span class="arrow" style="transform: rotate({{ station.sunPosition.az|add:-90 }}deg);">&#8594;</span>
                </td>
            </tr>
        </table>

    <h3>Sightings</h3>
        <table>
            <tr>
                <th>timestamp</th>
                <th>magnitude</th>
            </tr>
            {% for sighting in lastDay %}
                <tr>
                    <td class="data time"><a href="{% url 'sighting' id=sighting.id %}">{{ sighting.timestamp }}</td>
                    <td class="data magnitude">
                        {{ sighting.magnitude|stringformat:"+.2f"|default_if_none:"&mdash;" }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="2" class="empty">
                        There are no recorded sightings from this station within last 24 hours.
                    </td>
                </tr>
            {% endfor %}
        </table>

    <h3>Device log</h3>
        <table>
            <tr>
                <th>date</th>
                <th>entry</th>
            </tr>
            {% for entry in station.logentry_set.all %}
                <tr>
                    <td>{{ entry.created|date:"Y-m-d" }}</td>
                    <td>{{ entry.text }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="2" class="empty">
                        There are no log entries for this station.
                    </td>
                </tr>
            {% endfor %}
        </table>
{% endblock page %}
