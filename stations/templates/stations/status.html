{% extends 'core/base.html' %}
{% load station_tags %}

{% block pagetitle %}
<h2>Network status</h2>
{% endblock pagetitle %}

{% block page %}
    <table>
        <tr>
            <th>subnetwork</th>
            <th>code</th>
            <th>name</th>
            <th>status</th>
            <th colspan="2">&#x2600;</th>
            <th colspan="2">last sighting</th>
            <th>admin</th>
        </tr>
        {% for subnetwork in subnetworks %}
            {% for station in subnetwork.station_set.all %}
                <tr>
                    {% if forloop.first %}
                        <td rowspan="{{ subnetwork.station_set.all|length }}">{{ subnetwork.name }}</td>
                    {% endif %}
                    <td>{{ station.code }}</td>
                    <td><a href="{% url 'station' code=station.code %}">{{ station.name }}</a></td>
                    <td class="c">unknown</td>
                    <td id="{{ station.code }}-sunalt" class="r">
                        {{ station.sunPosition.alt|floatformat:1 }}°
                        <span style="display: inline-block; transform: rotate({{ station.sunPosition.alt|multiply:-1 }}deg);">&#8594;</span>
                    </td>
                    <td id="{{ station.code }}-sunaz" class="r">
                        {{ station.sunPosition.az|floatformat:1 }}°
                        <span style="display: inline-block; transform: rotate({{ station.sunPosition.az }}deg);">&#8594;</span>
                    </td>
                    <td class="c">
                        {% if station.lastSighting %}
                            {{ station.lastSighting.lightmaxTime }}
                        {% else %}never{% endif %}
                    </td>
                    <td class="c">
                        {{ station.lastSighting.lightmaxTime|default_if_none:"never"|timesince }}
                    </td>
                    <td class="c"><a href="{% url 'admin:stations_station_change' station.id %}">Edit</a></td>
                </tr>
            {% empty %}
                <tr>
                    <td>{{ subnetwork.name }}</td>
                    <td colspan="8" class="empty">No stations are defined for this subnetwork.</td>
                </tr>
            {% endfor %}
        {% endfor %}
    </table>
{% endblock page %}
